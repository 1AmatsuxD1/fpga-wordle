################################################################################
## FPGA Board #2: Display & Input - Pin Assignment (3-bit RGB)
## Board: Spartan-6 XC6SLX9-2TQG144C
## Clock: P123 (OSC) = 20 MHz
## VGA: 3-bit RGB (1 bit per color) - ใช้ K4 Connector
## Date: 2025-11-01
################################################################################

################################################################################
## System Clock & Reset
################################################################################

## System Clock: OSC (P123) = 20 MHz
NET "clk" LOC = P123 | IOSTANDARD = LVCMOS33;
NET "clk" TNM_NET = sys_clk_pin;
TIMESPEC TS_sys_clk_pin = PERIOD sys_clk_pin 50 ns HIGH 50%;  # 20 MHz

## System Reset: PB5
NET "rst" LOC = P51 | IOSTANDARD = LVCMOS33 | PULLDOWN;

################################################################################
## PS/2 Keyboard Interface
################################################################################

NET "ps2_clk"  LOC = P124 | IOSTANDARD = LVCMOS33 | PULLUP;  # K3 Pin 15
NET "ps2_data" LOC = P127 | IOSTANDARD = LVCMOS33 | PULLUP;  # K3 Pin 13

################################################################################
## VGA Display Interface (3-bit RGB - K4 Connector)
################################################################################

## H-Sync & V-Sync
NET "vga_hsync" LOC = P126 | IOSTANDARD = LVCMOS33 | DRIVE = 8 | SLEW = FAST;  # K4 Pin 15
NET "vga_vsync" LOC = P131 | IOSTANDARD = LVCMOS33 | DRIVE = 8 | SLEW = FAST;  # K4 Pin 13

## RGB (1 bit each)
NET "vga_r" LOC = P133 | IOSTANDARD = LVCMOS33 | DRIVE = 8 | SLEW = FAST;  # K4 Pin 11 (Red)
NET "vga_g" LOC = P137 | IOSTANDARD = LVCMOS33 | DRIVE = 8 | SLEW = FAST;  # K4 Pin 9  (Green)
NET "vga_b" LOC = P139 | IOSTANDARD = LVCMOS33 | DRIVE = 8 | SLEW = FAST;  # K4 Pin 7  (Blue)

################################################################################
## Serial Communication - ส่งคำทายไป FPGA #1
################################################################################

NET "serial_tx_data" LOC = P5  | IOSTANDARD = LVCMOS33;  # K1 Pin 15
NET "serial_tx_clk"  LOC = P7  | IOSTANDARD = LVCMOS33;  # K1 Pin 13
NET "data_valid"     LOC = P9  | IOSTANDARD = LVCMOS33;  # K1 Pin 11

################################################################################
## Serial Communication - รับผลลัพธ์จาก FPGA #1
################################################################################

NET "serial_rx_data" LOC = P11 | IOSTANDARD = LVCMOS33;  # K1 Pin 9
NET "serial_rx_clk"  LOC = P14 | IOSTANDARD = LVCMOS33;  # K1 Pin 7
NET "acknowledge"    LOC = P16 | IOSTANDARD = LVCMOS33;  # K1 Pin 5
NET "result_valid"   LOC = P21 | IOSTANDARD = LVCMOS33;  # K1 Pin 3

################################################################################
## Game Status (จาก FPGA #1)
################################################################################

NET "game_status<0>" LOC = P6  | IOSTANDARD = LVCMOS33;  # K2 Pin 15
NET "game_status<1>" LOC = P8  | IOSTANDARD = LVCMOS33;  # K2 Pin 13
NET "game_status<2>" LOC = P10 | IOSTANDARD = LVCMOS33;  # K2 Pin 11

################################################################################
## Debug LEDs (Optional)
################################################################################

NET "led_locked" LOC = P82 | IOSTANDARD = LVCMOS33;  # LED L0 - DCM Lock indicator

# NET "debug_led<1>" LOC = P81 | IOSTANDARD = LVCMOS33;  # LED L1
# NET "debug_led<2>" LOC = P80 | IOSTANDARD = LVCMOS33;  # LED L2
# NET "debug_led<3>" LOC = P79 | IOSTANDARD = LVCMOS33;  # LED L3

################################################################################
## Timing Constraints
################################################################################

## Generated clocks from DCM
# DCM จะจัดการ timing ของ clocks ที่สร้างขึ้นเอง
# ไม่จำเป็นต้องระบุ constraints สำหรับ internal clocks

## Serial Clock (2.5 MHz)
NET "serial_tx_clk" TNM_NET = serial_tx_clk;
TIMESPEC TS_serial_tx_clk = PERIOD serial_tx_clk 400 ns HIGH 50%;

NET "serial_rx_clk" TNM_NET = serial_rx_clk;
TIMESPEC TS_serial_rx_clk = PERIOD serial_rx_clk 400 ns HIGH 50%;

## Asynchronous Inputs
NET "ps2_clk" TIG;
NET "ps2_data" TIG;
NET "serial_rx_data" TIG;
NET "acknowledge" TIG;
NET "result_valid" TIG;
NET "game_status<*>" TIG;

################################################################################
## End of Constraints
################################################################################